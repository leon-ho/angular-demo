<!DOCTYPE html>
<html ng-app>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
    <script>
      function AcsCtrl($scope, $http) {
       
        $scope.persons = [];
        $scope.orderByColumn = 'name';
        $scope.orderReverse = false;
       
        $scope.searchAcs = function() {
          $http({
            method: 'JSONP',
            url: 'https://cv.altran.se/solr/collection1/select',
            params: {
              'json.wrf': 'JSON_CALLBACK',
              'q': $scope.searchQuery,
              'wt':'json',
              'rows':10,
              'fl': 'rendered',
              'facet': 'true',
              'facet.field': [
                'location_exact', 
                'department_exact',
                'years_of_experience_exact'
                ]
            }
          }).success(function (data) {
            $scope.persons = [];
            var docs = data.response.docs;
            for( var i=0; i<docs.length; i++ ) {
              var person = JSON.parse( docs[i].rendered );
              person.image = person.image.replace(/(.jpg|.png)/gi,'_scale_110x110.jpg');
              $scope.persons.push( person );
            }
            console.log($scope.persons);
          }).error(function () {
            $scope.persons = [{name:'Sum Ting Wong'}];
          });
        };
       
      }
    </script>
    <style>
      .photo_small { width: 64px; height: 64px; background-size: cover; }
    </style>
  </head>
  <body>
    <h2>ACS search</h2>
    <div ng-controller="AcsCtrl">
      <form>
        <input type="text" ng-model="searchQuery" placeholder="Search..." ng-change="searchAcs()" autofocus>
      </form>
      <table>
        <thead>
          <tr>
            <th></th>
            <th ng-click="orderByColumn='name';orderReverse:!orderReverse">Name</th>
            <th ng-click="orderByColumn='title';orderReverse:!orderReverse">Title</th>
            <th ng-click="orderByColumn='department';orderReverse:!orderReverse">Department</th>
          </tr>
        </thead>
        <tr ng-repeat="person in persons | orderBy:orderByColumn:orderReverse">
          <td><div style="background-image: url(http://cv.altran.se/media/{{person.image}})" class="photo_small"></div></td>
          <td>{{person.name}}</td>
          <td>{{person.title}}</td>
          <td>{{person.department}}</td>
        </tr>
      </table>
    </div>
  </body>
</html>